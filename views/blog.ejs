<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog Articles | CMS Blog</title>
    <link rel="stylesheet" href="/styles.css" />
    <style>
      /* Override grid layout to show exactly 3 cards per row */
      .articles-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 2rem;
        margin-bottom: 3rem;
      }

      /* Adjust for responsiveness */
      @media (max-width: 992px) {
        .articles-container {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 576px) {
        .articles-container {
          grid-template-columns: 1fr;
        }
      }

      .card-actions {
        display: flex;
        justify-content: space-between;
        margin-top: 1rem;
        align-items: center;
        position: relative;
        z-index: 10; /* Ensure buttons are above the card clickable area */
      }

      .delete-btn {
        background-color: var(--accent-color);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background-color 0.3s;
      }

      .delete-btn:hover {
        background-color: #c0392b;
      }

      .confirmation-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background-color: white;
        padding: 2rem;
        border-radius: 8px;
        width: 90%;
        max-width: 400px;
        text-align: center;
      }

      .modal-actions {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 1.5rem;
      }

      .modal-actions button {
        padding: 0.5rem 1.5rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
      }

      .cancel-btn {
        background-color: #f4f4f4;
        color: var(--dark-gray);
      }

      .confirm-btn {
        background-color: var(--accent-color);
        color: white;
      }

      /* Make the entire card clickable */
      .card {
        position: relative;
        cursor: pointer;
      }

      .card-clickable-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 5;
      }
    </style>
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar">
      <div class="nav-container">
        <a href="/" class="logo">CMS Blog</a>
        <ul class="nav-links">
          <li>
            <a href="/" class="<%= (currentPage === 'home') ? 'active' : '' %>"
              >Home</a
            >
          </li>
          <li>
            <a
              href="/blog"
              class="<%= (currentPage === 'blog') ? 'active' : '' %>"
              >Blog</a
            >
          </li>
          <li>
            <a
              href="/add-article"
              class="<%= (currentPage === 'add-article') ? 'active' : '' %>"
              >Add Article</a
            >
          </li>
        </ul>
      </div>
    </nav>

    <div class="container">
      <div class="blog-header">
        <h1>Latest Articles</h1>
      </div>

      <% if (articles.length === 0) { %>
      <div style="text-align: center; margin: 3rem 0">
        <p>No articles published yet.</p>
        <a href="/add-article" class="btn">Create Your First Article</a>
      </div>
      <% } else { %>
      <div class="articles-container">
        <% articles.forEach(article => { %>
        <div class="card" data-article-id="<%= article.id %>">
          <!-- Clickable overlay for the entire card -->
          <div class="card-clickable-overlay"></div>
          <img
            src="<%= article.image %>"
            alt="<%= article.title %>"
            class="card-image"
          />
          <div class="card-content">
            <h2><%= article.title %></h2>
            <div class="card-meta">
              <span><strong>By:</strong> <%= article.author %></span>
              <span
                ><strong>Date:</strong> <%= formatDate(article.date) %></span
              >
            </div>
            <div class="card-actions">
              <a href="/article/<%= article.id %>" class="read-more"
                >Read More</a
              >
              <button
                class="delete-btn"
                onclick="showDeleteConfirmation('<%= article.id %>', '<%= article.title %>')"
              >
                Delete
              </button>
            </div>
          </div>
        </div>
        <% }) %>
      </div>

      <% if (articles.length > 6) { %>
      <div class="load-more-container">
        <button class="btn" id="loadMoreBtn">Load More Articles</button>
      </div>
      <% } %> <% } %>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="confirmation-modal" id="deleteModal">
      <div class="modal-content">
        <h3>Confirm Deletion</h3>
        <p>
          Are you sure you want to delete this article? This action cannot be
          undone.
        </p>
        <p id="articleToDelete" style="font-weight: bold; margin-top: 1rem"></p>
        <div class="modal-actions">
          <button class="cancel-btn" onclick="hideDeleteConfirmation()">
            Cancel
          </button>
          <button class="confirm-btn" id="confirmDelete">Delete</button>
        </div>
      </div>
    </div>

    <footer>
      <p>
        &copy; <%= new Date().getFullYear() %> CMS Blog. All rights reserved.
      </p>
    </footer>

    <script>
      // Delete confirmation modal functionality
      let articleIdToDelete = null;

      function showDeleteConfirmation(id, title) {
        articleIdToDelete = id;
        document.getElementById("articleToDelete").textContent = title;
        document.getElementById("deleteModal").style.display = "flex";
        event.stopPropagation(); // Prevent card click when delete button is clicked
      }

      function hideDeleteConfirmation() {
        document.getElementById("deleteModal").style.display = "none";
      }

      document
        .getElementById("confirmDelete")
        .addEventListener("click", function () {
          if (articleIdToDelete) {
            // Create a form to submit the delete request
            const form = document.createElement("form");
            form.method = "POST";
            form.action = `/delete-article/${articleIdToDelete}`;
            document.body.appendChild(form);
            form.submit();
          }
        });

      // Load more functionality (showing just first 6 articles initially)
      const articles = document.querySelectorAll(".card");
      const loadMoreBtn = document.getElementById("loadMoreBtn");

      if (loadMoreBtn && articles.length > 6) {
        // Initially show only first 6 articles
        for (let i = 6; i < articles.length; i++) {
          articles[i].style.display = "none";
        }

        // Show 3 more articles when Load More is clicked
        let visibleCount = 6;
        loadMoreBtn.addEventListener("click", function () {
          for (
            let i = visibleCount;
            i < visibleCount + 3 && i < articles.length;
            i++
          ) {
            articles[i].style.display = "block";
          }
          visibleCount += 3;

          // Hide button when all articles are visible
          if (visibleCount >= articles.length) {
            loadMoreBtn.style.display = "none";
          }
        });
      }

      // Make entire card clickable
      document.querySelectorAll(".card").forEach((card) => {
        card.addEventListener("click", function (e) {
          // Don't redirect if clicking on the delete button or its children
          if (e.target.closest(".delete-btn")) {
            return;
          }

          // Get the article ID and navigate to the article page
          const articleId = this.getAttribute("data-article-id");
          window.location.href = `/article/${articleId}`;
        });
      });
    </script>
  </body>
</html>
